local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

Rayfield:Notify({
   Title = "Hello!",
   Content = "Enjoy the script :)",
   Duration = 6.5,
   Image = 4483362458,
})

-- Base64 encoding/decoding in Lua
local base64 = {}

local b = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/'
base64.encode = function(data)
    return ((data:gsub('.', function(x)
        local r, b = '', x:byte()
        for i = 8, 1, -1 do r = r .. (b % 2 ^ i - b % 2 ^ (i - 1) > 0 and '1' or '0' end
        return r
    end) .. '0000'):gsub('%d%d%d?%d?%d?%d?', function(x)
        if (#x < 6) then return '' end
        local c = 0
        for i = 1, 6 do c = c + (x:sub(i, i) == '1' and 2 ^ (6 - i) or 0 end
        return b:sub(c + 1, c + 1)
    end) .. ({ '', '==', '=' })[#data % 3 + 1]
end

base64.decode = function(data)
    data = data:gsub('[^' .. b .. '=]', '')
    return (data:gsub('.', function(x)
        if (x == '=') then return '' end
        local r, f = '', (b:find(x) - 1)
        for i = 6, 1, -1 do r = r .. (f % 2 ^ i - f % 2 ^ (i - 1) > 0 and '1' or '0' end
        return r
    end):gsub('%d%d%d?%d?%d?%d?%d?%d?', function(x)
        if (#x ~= 8) then return '' end
        local c = 0
        for i = 1, 8 do c = c + (x:sub(i, i) == '1' and 2 ^ (8 - i) or 0 end
        return string.char(c)
    end))
end

local Window = Rayfield:CreateWindow({
   Name = "Esp Script by Вася2",
   Icon = 0, 
   LoadingTitle = "Esp",
   LoadingSubtitle = "By Вася2",
   Theme = "Default",

   DisableRayfieldPrompts = false,
   DisableBuildWarnings = false,

   ConfigurationSaving = {
      Enabled = false,
      FolderName = nil,
      FileName = "Vasia2 Hub"
   },

   Discord = {
      Enabled = true, 
      Invite = "BxvGxzDB", 
      RememberJoins = true 
   },

   KeySystem = true, 
   KeySettings = {
      Title = "Vasia2",
      Subtitle = "Key System",
      Note = "Join to discord server for key: https://discord.gg/BxvGxzDB", 
      FileName = "Key",
      SaveKey = true, 
      GrabKeyFromSite = false,
      Key = {base64.decode("VmFzaWEyVG9w")} -- Расшифрованный ключ
   }
})

local Tab = Window:CreateTab("Esp Tab", 4483362458)

local Window = Rayfield:CreateWindow({
   Name = "Esp Script by Вася2",
   Icon = 0, 
   LoadingTitle = "Esp",
   LoadingSubtitle = "By Вася2",
   Theme = "Default",

   DisableRayfieldPrompts = false,
   DisableBuildWarnings = false,

   ConfigurationSaving = {
      Enabled = false,
      FolderName = nil,
      FileName = "Vasia2 Hub"
   },

   Discord = {
      Enabled = true, 
      Invite = "BxvGxzDB", 
      RememberJoins = true 
   },

   KeySystem = true, 
   KeySettings = {
      Title = "Vasia2",
      Subtitle = "Key System",
      Note = "Join to discord server for key: https://discord.gg/BxvGxzDB", 
      FileName = "Key",
      SaveKey = true, 
      GrabKeyFromSite = false,
      Key = {base64.decode("VmFzaWEyVG9w")} -- Расшифрованный ключ
   }
})

local Tab = Window:CreateTab("Esp Tab", 4483362458)

Rayfield:Notify({
   Title = "Hello!",
   Content = "Enjoy the script :)",
   Duration = 6.5,
   Image = 4483362458,
})

local Window = Rayfield:CreateWindow({
   Name = "Esp Script by Вася2",
   Icon = 0, 
   LoadingTitle = "Esp",
   LoadingSubtitle = "By Вася2",
   Theme = "Default",

   DisableRayfieldPrompts = false,
   DisableBuildWarnings = false,

   ConfigurationSaving = {
      Enabled = false,
      FolderName = nil,
      FileName = "Vasia2 Hub"
   },

   Discord = {
      Enabled = true, 
      Invite = "BxvGxzDB", 
      RememberJoins = true 
   },

local Tab = Window:CreateTab("Esp Tab", 4483362458)

-- Initialization of toggles
local espEnabled = false
local nameEnabled = false
local hpEnabled = false
local lineEnabled = false
local lines = {}

-- Toggle for ESP
local function toggleESP()
	espEnabled = not espEnabled

	for _, targetPlayer in ipairs(game:GetService("Players"):GetPlayers()) do
		if targetPlayer ~= game.Players.LocalPlayer then
			local character = targetPlayer.Character
			if character then
				for _, part in pairs(character:GetChildren()) do
					if part:IsA("BasePart") then
						if espEnabled then
							local highlight = Instance.new("BoxHandleAdornment")
							highlight.Name = "ESPHighlight"
							highlight.Adornee = part
							highlight.AlwaysOnTop = true
							highlight.ZIndex = 5
							highlight.Size = part.Size + Vector3.new(0.1, 0.1, 0.1)
							highlight.Color3 = Color3.fromRGB(255, 0, 0)
							highlight.Transparency = 0.5
							highlight.Parent = part
						else
							if part:FindFirstChild("ESPHighlight") then
								part.ESPHighlight:Destroy()
							end
						end
					end
				end
			end
		end
	end
end

-- Toggle for HP display
local function toggleHP()
	hpEnabled = not hpEnabled

	for _, targetPlayer in ipairs(game:GetService("Players"):GetPlayers()) do
		if targetPlayer ~= game.Players.LocalPlayer then
			local character = targetPlayer.Character
			if character and character:FindFirstChild("Humanoid") and character:FindFirstChild("Head") then
				local humanoid = character.Humanoid

				if hpEnabled then
					local billboard = Instance.new("BillboardGui")
					billboard.Name = "HPBar"
					billboard.Size = UDim2.new(0, 200, 0, 50)
					billboard.Adornee = character.Head
					billboard.StudsOffset = Vector3.new(0, 2, 0)
					billboard.AlwaysOnTop = true
					billboard.Parent = character.Head

					local hpLabel = Instance.new("TextLabel")
					hpLabel.Size = UDim2.new(1, 0, 1, 0)
					hpLabel.BackgroundTransparency = 1
					hpLabel.Text = "HP: " .. math.floor(humanoid.Health)
					hpLabel.TextColor3 = Color3.new(0, 1, 0)
					hpLabel.TextScaled = true
					hpLabel.Parent = billboard

					humanoid:GetPropertyChangedSignal("Health"):Connect(function()
						if hpLabel then
							hpLabel.Text = "HP: " .. math.floor(humanoid.Health)
						end
					end)
				else
					if character.Head:FindFirstChild("HPBar") then
						character.Head.HPBar:Destroy()
					end
				end
			end
		end
	end
end

-- Toggle for Name display
local function toggleName()
	nameEnabled = not nameEnabled

	for _, targetPlayer in ipairs(game:GetService("Players"):GetPlayers()) do
		if targetPlayer ~= game.Players.LocalPlayer then
			local character = targetPlayer.Character
			if character and character:FindFirstChild("Head") then
				if nameEnabled then
					local billboard = Instance.new("BillboardGui")
					billboard.Name = "NameTag"
					billboard.Size = UDim2.new(0, 200, 0, 50)
					billboard.Adornee = character.Head
					billboard.AlwaysOnTop = true
					billboard.Parent = character.Head

					local nameLabel = Instance.new("TextLabel")
					nameLabel.Size = UDim2.new(1, 0, 1, 0)
					nameLabel.BackgroundTransparency = 1
					nameLabel.Text = targetPlayer.Name
					nameLabel.TextColor3 = Color3.new(1, 1, 1)
					nameLabel.TextScaled = true
					nameLabel.Parent = billboard
				else
					if character.Head:FindFirstChild("NameTag") then
						character.Head.NameTag:Destroy()
					end
				end
			end
		end
	end
end

-- Toggle for Lines
local function toggleLines()
	lineEnabled = not lineEnabled

	for _, line in pairs(lines) do
		line:Destroy()
	end
	lines = {}

	if lineEnabled then
		for _, targetPlayer in ipairs(game:GetService("Players"):GetPlayers()) do
			if targetPlayer ~= game.Players.LocalPlayer then
				local character = targetPlayer.Character
				if character and character:FindFirstChild("HumanoidRootPart") then
					local line = Drawing.new("Line")
					table.insert(lines, line)

					game:GetService("RunService").RenderStepped:Connect(function()
						if character and character:FindFirstChild("HumanoidRootPart") then
							local rootPart = character.HumanoidRootPart
							local screenPos, onScreen = workspace.CurrentCamera:WorldToViewportPoint(rootPart.Position)

							if onScreen then
								line.Visible = true
								line.From = Vector2.new(workspace.CurrentCamera.ViewportSize.X / 2, workspace.CurrentCamera.ViewportSize.Y)
								line.To = Vector2.new(screenPos.X, screenPos.Y)
								line.Color = Color3.new(0, 1, 0)
								line.Thickness = 2
							else
								line.Visible = false
							end
						else
							line:Remove()
						end
					end)
				end
			end
		end
	end
end

-- Add toggles for Name, HP, and Lines to the Rayfield window
Tab:CreateToggle({
   Name = "Esp",
   CurrentValue = espEnabled,
   Flag = "EspToggle", 
   Callback = function(Value)
      toggleESP()
   end,
})

Tab:CreateToggle({
   Name = "Hp",
   CurrentValue = hpEnabled,
   Flag = "HpToggle", 
   Callback = function(Value)
      toggleHP()
   end,
})

Tab:CreateToggle({
   Name = "NickName",
   CurrentValue = nameEnabled,
   Flag = "NameToggle", 
   Callback = function(Value)
      toggleName()
   end,
})

Tab:CreateToggle({
   Name = "Line",
   CurrentValue = lineEnabled,
   Flag = "LineToggle", 
   Callback = function(Value)
      toggleLines()
   end,
})
